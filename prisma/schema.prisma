generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model messages {
  id                BigInt              @id @default(autoincrement())
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  sent_by           String?             @default("") @db.VarChar
  sent_to           String?             @default("") @db.VarChar
  content           String?             @default("")
  conversation_id   String              @db.Uuid
  sender_id         BigInt?
  image_url         String?
  type              String              @default("message")
  edited_at         DateTime?           @db.Timestamptz(6)
  deleted           Boolean?            @default(false)
  parent_id         BigInt?
  message_reactions message_reactions[]
  message_reads     message_reads[]
  conversations     conversations       @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_messages_conversation")
  sender            profiles?           @relation(fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_messages_sender")
  messages          messages?           @relation("messagesTomessages", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_messages    messages[]          @relation("messagesTomessages")

  @@schema("public")
}

model profiles {
  id                   BigInt                 @id @default(autoincrement())
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  user_id              String?                @unique @db.Uuid
  username             String                 @unique @default("") @db.VarChar
  avatar               String?                @default("") @db.VarChar
  display_name         String?                @default("") @db.VarChar
  conversation_members conversation_members[]
  message_reactions    message_reactions[]
  message_reads        message_reads[]
  messages             messages[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model conversation_members {
  conversation_id String        @db.Uuid
  profile_id      BigInt
  conversation    conversations @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  profiles        profiles      @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_conversation_members_profile")

  @@id([conversation_id, profile_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model conversations {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  name                 String                 @default("Unnamed Conversation")
  conversation_members conversation_members[]
  messages             messages[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model message_reactions {
  id         BigInt   @id(map: "message_reaction_pkey") @default(autoincrement())
  created_at DateTime @default(now()) @db.Timestamptz(6)
  emoji      String
  message_id BigInt
  profile_id BigInt
  messages   messages @relation(fields: [message_id], references: [id], onDelete: Cascade, map: "message_reaction_message_id_fkey")
  profiles   profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade, map: "message_reaction_profile_id_fkey")

  @@unique([message_id, profile_id, emoji], map: "message_reaction_unique_per_user")
  @@schema("public")
}

model message_reads {
  id         BigInt   @id @default(autoincrement())
  message_id BigInt
  profile_id BigInt
  created_at DateTime @default(now()) @db.Timestamptz(6)
  messages   messages @relation(fields: [message_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles   profiles @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([message_id, profile_id], map: "message_read_unique")
  @@index([message_id], map: "idx_message_reads_message_id")
  @@index([profile_id], map: "idx_message_reads_profile_id")
  @@schema("public")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model policy_backup {
  backed_up_at DateTime?              @db.Timestamptz(6)
  schemaname   Unsupported("name")?
  tablename    Unsupported("name")?
  policyname   Unsupported("name")?
  permissive   String?
  roles        Unsupported("_name")[]
  cmd          String?
  qual         String?
  with_check   String?

  @@ignore
  @@schema("public")
}

enum aal_level {
  aal1
  aal2
  aal3

  @@schema("auth")
}

enum code_challenge_method {
  s256
  plain

  @@schema("auth")
}

enum factor_status {
  unverified
  verified

  @@schema("auth")
}

enum factor_type {
  totp
  webauthn
  phone

  @@schema("auth")
}

enum one_time_token_type {
  confirmation_token
  reauthentication_token
  recovery_token
  email_change_token_new
  email_change_token_current
  phone_change_token

  @@schema("auth")
}

enum oauth_registration_type {
  dynamic
  manual

  @@schema("auth")
}
